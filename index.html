<!DOCTYPE html><html>
<head>
  <meta charset="utf-8">
  <title>Беспилотники в Павлодаре</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map { height: 100vh; }
    .car {
      background: blue;
      border-radius: 50%;
      width: 12px;
      height: 12px;
      position: absolute;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Инициализация карты Павлодара
    const map = L.map('map').setView([52.2872, 76.9674], 14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);// Фиксированные маршруты (условные координаты на карте)
const routes = [
  [[52.2900, 76.9600], [52.2920, 76.9700], [52.2890, 76.9800]],
  [[52.2850, 76.9600], [52.2830, 76.9700], [52.2850, 76.9800]],
  [[52.2880, 76.9550], [52.2885, 76.9650], [52.2890, 76.9750]],
  [[52.2860, 76.9800], [52.2840, 76.9700], [52.2820, 76.9600]],
  [[52.2910, 76.9800], [52.2925, 76.9700], [52.2940, 76.9600]],
  [[52.2870, 76.9850], [52.2860, 76.9750], [52.2850, 76.9650]],
  [[52.2840, 76.9600], [52.2845, 76.9700], [52.2850, 76.9800]],
  [[52.2895, 76.9650], [52.2900, 76.9750], [52.2910, 76.9850]]
];

// Пробки (рандомно появляются и исчезают)
let congestion = [];
function randomizeCongestion() {
  congestion = routes.map(route => {
    const color = Math.random() < 0.33 ? 'green' : Math.random() < 0.5 ? 'yellow' : 'red';
    return { segment: route[1], color };
  });
}

function drawCongestion() {
  congestion.forEach(({ segment, color }) => {
    L.circleMarker(segment, {
      radius: 10,
      color,
      fillColor: color,
      fillOpacity: 0.5
    }).addTo(map);
  });
}

function animateCar(route, delay) {
  const marker = L.circleMarker(route[0], { radius: 6, color: 'blue', fillColor: 'blue', fillOpacity: 1 }).addTo(map);
  let index = 0;
  setTimeout(function move() {
    index++;
    if (index < route.length) {
      marker.setLatLng(route[index]);
      setTimeout(move, 1500);
    }
  }, delay);
}

// Запуск симуляции
randomizeCongestion();
drawCongestion();

routes.forEach((route, i) => {
  animateCar(route, i * 800);
});

// Обновление пробок каждые 20 секунд
setInterval(() => {
  map.eachLayer(layer => {
    if (layer instanceof L.CircleMarker && layer.options.radius === 10) {
      map.removeLayer(layer);
    }
  });
  randomizeCongestion();
  drawCongestion();
}, 20000);

  </script>
</body>
</html>
